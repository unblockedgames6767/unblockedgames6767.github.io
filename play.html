<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <!-- Dynamic SEO ‚Äî updated by JS per game -->
    <title id="pageTitle">Play Free Unblocked Games ‚Äì UnblockedGames67</title>
    <meta name="description" id="pageDesc" content="Play free unblocked games at school on UnblockedGames67. Slope, Retro Bowl, Poly Track, 1v1.LOL & more ‚Äî no downloads, always free!">
    <meta name="keywords" content="unblocked games 67, play unblocked game online, free browser game no download, unblocked games at school">
    <link rel="canonical" id="pageCanonical" href="https://unblockedgames67.github.io/play.html">
    <link rel="icon" type="image/x-icon" href="assets/img/icon/main.png">

    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">

    <!-- Open Graph (updated by JS) -->
    <meta property="og:type" content="website">
    <meta property="og:url" id="ogUrl" content="https://unblockedgames67.github.io/play.html">
    <meta property="og:title" id="ogTitle" content="Play Free Unblocked Games ‚Äì UnblockedGames67">
    <meta property="og:description" id="ogDesc" content="Play free unblocked games at school ‚Äî no downloads, no sign-up, always free on UnblockedGames67!">
    <meta property="og:image" id="ogImage" content="https://unblockedgames67.github.io/assets/img/icon/main.png">
    <meta property="og:site_name" content="UnblockedGames67">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twTitle" content="Play Free Unblocked Games ‚Äì UnblockedGames67">
    <meta name="twitter:description" id="twDesc" content="Play free unblocked games at school on UnblockedGames67!">
    <meta name="twitter:image" id="twImage" content="https://unblockedgames67.github.io/assets/img/icon/main.png">

    <!-- Crawlers -->
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large">

    <!-- PWA / Mobile -->
    <meta name="theme-color" content="#f5a97f">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="UnblockedGames67">

    <!-- fonts loaded in style tag -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google AdSense ‚Äî replace ca-pub-XXXXXXXXXXXXXXXX with your publisher ID -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>


    <!-- Game-specific structured data ‚Äî updated by JS -->
    <script type="application/ld+json" id="gameSchema">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Play Free Unblocked Games",
        "url": "https://unblockedgames67.github.io/play.html",
        "isPartOf": {
            "@type": "WebSite",
            "name": "Unblocked Games 67",
            "url": "https://unblockedgames67.github.io/"
        }
    }
    </script>

    <!-- BreadcrumbList schema ‚Äî updated by JS -->
    <script type="application/ld+json" id="breadcrumbSchema">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://unblockedgames67.github.io/"},
            {"@type": "ListItem", "position": 2, "name": "Play Game", "item": "https://unblockedgames67.github.io/play.html"}
        ]
    }
    </script>


    <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Barlow+Condensed:wght@400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google AdSense ‚Äî replace ca-pub-XXXXXXXXXXXXXXXX with your publisher ID -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>

    <style>
        /* ‚ïê‚ïê‚ïê PLAY PAGE ‚Äî NEON ARCADE THEME ‚ïê‚ïê‚ïê */
        :root {
            --cyan: #00F5D4;
            --pink: #FF006E;
            --yellow: #FFD500;
            --purple: #9B5DE5;
            --bg: #06060a;
            --bg-card: #0e0e16;
            --bg-elevated: #14141f;
            --border: rgba(0,245,212,0.15);
            --border-bright: rgba(0,245,212,0.6);
            --text: #e8e8f0;
            --text-dim: #6e6e88;
            --glow-cyan: 0 0 20px rgba(0,245,212,0.4), 0 0 60px rgba(0,245,212,0.15);
            --glow-pink: 0 0 20px rgba(255,0,110,0.4);
            --glow-yellow: 0 0 20px rgba(255,213,0,0.4);
        }

        [data-theme="light"] {
            --bg: #f0f2f8; --bg-card: #ffffff; --bg-elevated: #e8eaf0;
            --border: rgba(0,150,120,0.2); --border-bright: rgba(0,150,120,0.5);
            --text: #0a0a14; --text-dim: #555570;
        }

        * { margin:0; padding:0; box-sizing:border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed; inset: 0;
            background-image: radial-gradient(circle, rgba(0,245,212,0.05) 1px, transparent 1px);
            background-size: 32px 32px;
            pointer-events: none; z-index: 0;
        }

        /* ‚ïê‚ïê NAV ‚ïê‚ïê */
        nav {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(6,6,10,0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-bright);
            padding: 0 1.5rem;
            height: 56px;
            display: flex; align-items: center; gap: 1rem;
        }

        .nav-logo {
            display: flex; align-items: center; gap: 0.6rem;
            text-decoration: none; flex-shrink: 0;
        }

        .nav-logo-badge {
            background: var(--cyan); color: #000;
            font-family: 'Bungee', cursive;
            font-size: 0.9rem; width: 32px; height: 32px;
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            box-shadow: var(--glow-cyan);
        }

        .nav-logo-text {
            font-family: 'Bungee', cursive; font-size: 0.85rem; color: var(--text);
        }
        .nav-logo-text span { color: var(--cyan); }

        .nav-back {
            display: flex; align-items: center; gap: 0.4rem;
            background: var(--bg-elevated); border: 1px solid var(--border);
            color: var(--text-dim); padding: 0.4rem 0.9rem; border-radius: 6px;
            font-size: 0.82rem; font-family: 'Barlow Condensed', sans-serif;
            font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase;
            cursor: pointer; text-decoration: none; transition: all 0.2s;
        }
        .nav-back:hover { border-color: var(--cyan); color: var(--cyan); }

        .nav-right { margin-left: auto; display: flex; gap: 0.6rem; align-items: center; }

        .nav-game-title {
            font-family: 'Bungee', cursive; font-size: 1rem;
            color: var(--text); flex: 1;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            max-width: 300px;
        }

        .streak-badge {
            display: flex; align-items: center; gap: 0.35rem;
            background: rgba(255,213,0,0.1); border: 1px solid rgba(255,213,0,0.3);
            color: var(--yellow); padding: 0.3rem 0.65rem; border-radius: 50px;
            font-size: 0.78rem; font-weight: 700; font-family: 'Barlow Condensed', sans-serif;
        }

        .theme-toggle {
            background: var(--bg-elevated); border: 1px solid var(--border);
            color: var(--text-dim); width: 32px; height: 32px; border-radius: 50%;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; transition: all 0.2s;
        }
        .theme-toggle:hover { border-color: var(--cyan); color: var(--cyan); }

        /* ‚ïê‚ïê MAIN LAYOUT ‚ïê‚ïê */
        .play-layout {
            max-width: 1500px;
            margin: 0 auto;
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 1fr 320px;
            grid-template-rows: auto 1fr;
            gap: 1.25rem;
            position: relative;
            z-index: 1;
        }

        /* ‚ïê‚ïê GAME FRAME ‚ïê‚ïê */
        .game-frame-wrap {
            grid-column: 1; grid-row: 1 / 3;
            display: flex; flex-direction: column; gap: 1rem;
        }

        .game-topbar {
            display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap;
        }

        .game-name-display {
            font-family: 'Bungee', cursive;
            font-size: 1.5rem; color: var(--text);
            flex: 1;
        }

        .game-name-display span { color: var(--cyan); }

        .game-tag-badge {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.72rem; font-weight: 700; letter-spacing: 0.1em;
            text-transform: uppercase; padding: 0.25rem 0.75rem; border-radius: 4px;
            border: 1px solid var(--border-bright); color: var(--cyan);
        }

        .game-controls-bar {
            display: flex; gap: 0.5rem; flex-wrap: wrap;
        }

        .ctrl-btn {
            display: flex; align-items: center; gap: 0.35rem;
            background: var(--bg-card); border: 1px solid var(--border);
            color: var(--text-dim); padding: 0.45rem 0.9rem;
            border-radius: 6px; cursor: pointer; font-size: 0.82rem;
            font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
            letter-spacing: 0.06em; text-transform: uppercase;
            transition: all 0.2s;
        }
        .ctrl-btn:hover { border-color: var(--cyan); color: var(--cyan); }
        .ctrl-btn.active { background: rgba(0,245,212,0.1); border-color: var(--cyan); color: var(--cyan); }
        .ctrl-btn.pink:hover { border-color: var(--pink); color: var(--pink); }
        .ctrl-btn.pink.active { background: rgba(255,0,110,0.1); border-color: var(--pink); color: var(--pink); }

        .game-frame {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 40px rgba(0,245,212,0.05);
        }

        .game-frame.neon-border { border-color: var(--cyan); box-shadow: var(--glow-cyan); }

        .game-iframe {
            width: 100%; height: 72vh; border: none; display: block; background: #000;
        }

        /* Loading state */
        .game-loading {
            position: absolute; inset: 0;
            background: var(--bg-card);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 1rem; color: var(--text-dim); font-size: 0.9rem; z-index: 5;
        }

        .game-loading .spinner {
            width: 40px; height: 40px;
            border: 3px solid var(--border); border-top-color: var(--cyan);
            border-radius: 50%; animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
        .sidebar {
            grid-column: 2; grid-row: 1 / 3;
            display: flex; flex-direction: column; gap: 1.25rem;
            overflow-y: auto; max-height: calc(100vh - 80px); position: sticky; top: 70px;
        }

        .sidebar-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            overflow: hidden;
        }

        .panel-header {
            padding: 0.85rem 1rem;
            border-bottom: 1px solid var(--border);
            font-family: 'Bungee', cursive;
            font-size: 0.85rem;
            color: var(--text);
            display: flex; align-items: center; gap: 0.5rem;
        }

        .panel-header i { color: var(--cyan); }

        /* Game info panel */
        .game-meta { padding: 1rem; }

        .game-desc {
            font-size: 0.85rem; color: var(--text-dim); line-height: 1.65;
            margin-bottom: 1rem;
        }

        /* Action buttons */
        .action-grid {
            display: grid; grid-template-columns: 1fr 1fr;
            gap: 0.5rem; padding: 0.75rem;
        }

        .action-btn {
            display: flex; align-items: center; justify-content: center; gap: 0.35rem;
            padding: 0.65rem; border-radius: 7px;
            border: 1px solid var(--border); background: var(--bg-elevated);
            color: var(--text-dim); font-size: 0.8rem; cursor: pointer;
            font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
            letter-spacing: 0.05em; text-transform: uppercase; transition: all 0.2s;
        }

        .action-btn:hover { border-color: var(--cyan); color: var(--cyan); }
        .action-btn.active { background: rgba(255,0,110,0.1); border-color: var(--pink); color: var(--pink); }

        /* Star rating */
        .rating-row {
            display: flex; gap: 0.3rem; padding: 0 1rem 1rem;
        }

        .star {
            font-size: 1.3rem; cursor: pointer; color: var(--text-dim);
            transition: color 0.15s, transform 0.15s;
        }

        .star:hover, .star.active { color: var(--yellow); transform: scale(1.2); }

        /* Playtime */
        .playtime-display {
            padding: 0.75rem 1rem;
            border-top: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
        }

        .playtime-label {
            font-size: 0.75rem; font-family: 'Barlow Condensed', sans-serif;
            font-weight: 700; letter-spacing: 0.08em; text-transform: uppercase;
            color: var(--text-dim);
        }

        .playtime-value { font-family: 'Bungee', cursive; font-size: 1rem; color: var(--cyan); }

        /* Achievements */
        .achievements-list { padding: 0.75rem; display: flex; flex-direction: column; gap: 0.4rem; }

        .achievement-item {
            display: flex; align-items: center; gap: 0.6rem;
            padding: 0.5rem 0.65rem; border-radius: 6px;
            background: var(--bg-elevated);
        }

        .achievement-item.locked { opacity: 0.45; }

        .achievement-icon { font-size: 1.2rem; }

        .achievement-name {
            font-family: 'Barlow Condensed', sans-serif;
            font-weight: 700; font-size: 0.82rem; color: var(--text);
        }

        .achievement-desc { font-size: 0.72rem; color: var(--text-dim); }

        .achievement-check {
            margin-left: auto; color: var(--cyan); font-size: 0.8rem;
        }

        /* Recommended */
        .recommended-list { display: flex; flex-direction: column; }

        .rec-item {
            display: flex; align-items: center; gap: 0.75rem;
            padding: 0.6rem 0.85rem;
            border-bottom: 1px solid var(--border); cursor: pointer;
            text-decoration: none; transition: background 0.15s;
        }

        .rec-item:last-child { border-bottom: none; }
        .rec-item:hover { background: rgba(0,245,212,0.04); }

        .rec-img {
            width: 44px; height: 44px; object-fit: cover;
            border-radius: 6px; border: 1px solid var(--border); flex-shrink: 0;
        }

        .rec-name {
            font-family: 'Barlow Condensed', sans-serif;
            font-weight: 700; font-size: 0.88rem; color: var(--text);
        }

        .rec-tag { font-size: 0.7rem; color: var(--text-dim); }

        /* Playtime chart */
        .chart-wrap { padding: 0.75rem; }

        /* Notes */
        .notes-wrap { padding: 0.75rem; }

        .notes-wrap textarea {
            width: 100%; background: var(--bg-elevated); border: 1px solid var(--border);
            border-radius: 6px; color: var(--text); padding: 0.65rem 0.75rem;
            font-size: 0.83rem; resize: vertical; min-height: 80px;
            font-family: 'DM Sans', sans-serif; outline: none; transition: border-color 0.2s;
        }

        .notes-wrap textarea:focus { border-color: var(--cyan); }

        .save-notes-btn {
            width: 100%; margin-top: 0.5rem;
            background: var(--cyan); color: #000;
            border: none; border-radius: 6px; padding: 0.5rem;
            font-family: 'Barlow Condensed', sans-serif; font-weight: 800;
            font-size: 0.82rem; letter-spacing: 0.08em; text-transform: uppercase;
            cursor: pointer; transition: opacity 0.2s;
        }

        .save-notes-btn:hover { opacity: 0.85; }

        /* ‚ïê‚ïê TOAST ‚ïê‚ïê */
        .toast {
            position: fixed; bottom: 2rem; right: 2rem;
            background: var(--bg-elevated); border: 1px solid var(--cyan);
            border-radius: 8px; padding: 0.75rem 1.1rem;
            display: none; align-items: center; gap: 0.6rem;
            box-shadow: var(--glow-cyan); z-index: 9000;
            animation: slideUp 0.3s ease;
        }

        .toast.active { display: flex; }

        @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }

        .toast i { color: var(--cyan); }

        .toast-text {
            font-family: 'Barlow Condensed', sans-serif;
            font-weight: 600; font-size: 0.88rem;
        }

        /* ‚ïê‚ïê ACHIEVEMENT TOAST ‚ïê‚ïê */
        .achievement-toast {
            position: fixed; top: 80px; right: 2rem;
            background: var(--bg-elevated); border: 1px solid var(--yellow);
            border-radius: 10px; padding: 1rem 1.25rem;
            display: none; align-items: center; gap: 1rem;
            box-shadow: var(--glow-yellow); z-index: 9001;
            max-width: 320px;
        }

        .achievement-toast.active { display: flex; }
        .achievement-toast-icon { font-size: 2rem; }
        .achievement-toast-title { font-family: 'Bungee', cursive; font-size: 0.9rem; color: var(--yellow); }
        .achievement-toast-name { font-weight: 700; font-size: 0.85rem; color: var(--text); margin-top: 0.2rem; }

        /* ‚ïê‚ïê MODALS ‚ïê‚ïê */
        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            display: none; align-items: center; justify-content: center;
            z-index: 8000; padding: 1rem;
        }

        .modal-overlay.active { display: flex; }

        .modal-box {
            background: var(--bg-card); border: 1px solid var(--border-bright);
            border-radius: 14px; padding: 1.75rem; max-width: 520px; width: 100%;
            box-shadow: var(--glow-cyan); max-height: 80vh; overflow-y: auto;
        }

        .modal-title {
            font-family: 'Bungee', cursive; font-size: 1.3rem;
            color: var(--text); margin-bottom: 1.25rem;
            display: flex; align-items: center; gap: 0.5rem;
        }

        .modal-title i { color: var(--cyan); }

        .modal-close {
            float: right; background: none; border: none; color: var(--text-dim);
            font-size: 1.1rem; cursor: pointer; transition: color 0.2s;
        }

        .modal-close:hover { color: var(--pink); }

        .shortcut-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.6rem 0; border-bottom: 1px solid var(--border);
            font-size: 0.88rem; color: var(--text-dim);
        }

        .shortcut-row:last-child { border-bottom: none; }

        .shortcut-key {
            background: var(--bg-elevated); border: 1px solid var(--border);
            border-radius: 4px; padding: 0.2rem 0.5rem; font-size: 0.78rem;
            font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
            color: var(--cyan); letter-spacing: 0.06em;
        }

        /* Achievement grid in modal */
        .achievement-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;
        }

        .achievement-card {
            background: var(--bg-elevated); border: 1px solid var(--border);
            border-radius: 8px; padding: 0.85rem; display: flex; flex-direction: column;
            gap: 0.3rem; align-items: flex-start;
        }

        .achievement-card.unlocked { border-color: var(--cyan); }
        .achievement-card .ach-icon { font-size: 1.5rem; }
        .achievement-card .ach-name { font-weight: 700; font-size: 0.85rem; }
        .achievement-card .ach-desc { font-size: 0.75rem; color: var(--text-dim); }
        .achievement-card.locked { opacity: 0.4; }

        /* ‚ïê‚ïê RESPONSIVE ‚ïê‚ïê */
        @media (max-width: 900px) {
            .play-layout { grid-template-columns: 1fr; }
            .sidebar { grid-column: 1; position: static; max-height: none; }
            .game-frame-wrap { grid-column: 1; }
            .game-iframe { height: 55vw; min-height: 300px; }
        }

        @media (max-width: 600px) {
            .play-layout { padding: 0.75rem; }
            .nav { padding: 0 0.75rem; }
            .game-name-display { font-size: 1.1rem; }
        }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê NAV ‚ïê‚ïê -->
<nav>
    <a href="/" class="nav-logo">
        <div class="nav-logo-badge">67</div>
        <div class="nav-logo-text">UB<span>67</span></div>
    </a>
    <a href="/" class="nav-back"><i class="fas fa-arrow-left"></i> All Games</a>
    <span class="nav-game-title" id="navGameTitle">Loading...</span>
    <div class="nav-right">
        <div class="streak-badge" id="streakBadge">üî• <span id="streakCount">0</span></div>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme"><i class="fas fa-moon"></i></button>
    </div>
</nav>

<!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
<div class="play-layout">

    <!-- Left: Game Frame -->
    <div class="game-frame-wrap">
        <!-- Topbar: game name + tags -->
        <div class="game-topbar">
            <div class="game-name-display" id="gameNameDisplay">Loading...</div>
            <span class="game-tag-badge" id="gameTagBadge">game</span>
            <div class="game-controls-bar" style="margin-left:auto;">
                <button class="ctrl-btn" id="fullscreenBtn" title="Fullscreen (F)">
                    <i class="fas fa-expand"></i> Full
                </button>
                <button class="ctrl-btn" id="refreshBtn" title="Refresh (R)">
                    <i class="fas fa-redo"></i>
                </button>
                <button class="ctrl-btn pink" id="favoriteBtn" title="Favorite (H)">
                    <i class="far fa-heart"></i> Fave
                </button>
                <button class="ctrl-btn" id="shareBtn" title="Share (Shift+S)">
                    <i class="fas fa-share-alt"></i>
                </button>
                <button class="ctrl-btn" id="shortcutsBtn" title="Shortcuts (?)">
                    <i class="fas fa-keyboard"></i>
                </button>
            </div>
        </div>

        <!-- Iframe -->
        <div class="game-frame" id="gameFrame">
            <div class="game-loading" id="gameLoading">
                <div class="spinner"></div>
                <span>Loading game...</span>
            </div>
            <iframe id="gameIframe" class="game-iframe" allowfullscreen
                allow="autoplay; fullscreen; payment" title="Unblocked Game"></iframe>
        </div>

        <!-- Credits -->
        <div id="gameCredits" style="font-size:0.75rem;color:var(--text-dim);"></div>

        <!-- AdSense: Below-Game Leaderboard ‚Äî MUST be below iframe, never overlapping -->
        <!-- AdSense policy: do not place ads where accidental clicks are likely (near game controls) -->
        <div style="margin-top:1rem;text-align:center;" aria-label="Advertisement">
            <p style="font-size:0.65rem;color:var(--text-dim);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:0.3rem;font-family:'Barlow Condensed',sans-serif;">Advertisement</p>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
                 data-ad-slot="3333333333"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>
    </div>

    <!-- Right: Sidebar -->
    <div class="sidebar">

        <!-- Info panel -->
        <div class="sidebar-panel">
            <div class="panel-header"><i class="fas fa-gamepad"></i> Game Info</div>
            <div class="game-meta">
                <div class="game-desc" id="gameDescription">Loading game description...</div>
                <div style="font-size:0.75rem;color:var(--text-dim);" id="gameCreditsSmall"></div>
            </div>
            <div class="playtime-display">
                <span class="playtime-label"><i class="fas fa-clock"></i> Your Playtime</span>
                <span class="playtime-value" id="playtimeDisplay">0:00</span>
            </div>
            <div style="padding:0 1rem 0.75rem;">
                <div style="font-size:0.72rem;color:var(--text-dim);font-family:'Barlow Condensed',sans-serif;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;margin-bottom:0.5rem;">Rate this game</div>
                <div class="rating-row">
                    <span class="star" data-rating="1">‚òÖ</span>
                    <span class="star" data-rating="2">‚òÖ</span>
                    <span class="star" data-rating="3">‚òÖ</span>
                    <span class="star" data-rating="4">‚òÖ</span>
                    <span class="star" data-rating="5">‚òÖ</span>
                </div>
            </div>
        </div>

        <!-- Quick actions -->
        <div class="sidebar-panel">
            <div class="panel-header"><i class="fas fa-bolt"></i> Quick Actions</div>
            <div class="action-grid">
                <button class="action-btn" id="screenshotBtn"><i class="fas fa-camera"></i> Screenshot</button>
                <button class="action-btn" id="pipBtn"><i class="fas fa-compress"></i> Mini Mode</button>
                <button class="action-btn" id="achievementsBtn"><i class="fas fa-trophy"></i> Achievements</button>
                <button class="action-btn" id="shortcutsBtnSide"><i class="fas fa-keyboard"></i> Shortcuts</button>
            </div>
        </div>

        <!-- Playtime chart -->
        <div class="sidebar-panel">
            <div class="panel-header"><i class="fas fa-chart-bar"></i> Session Stats</div>
            <div class="chart-wrap">
                <canvas id="playtimeChart" height="120"></canvas>
            </div>
        </div>

        <!-- Achievements -->
        <div class="sidebar-panel">
            <div class="panel-header"><i class="fas fa-trophy"></i> Achievements</div>
            <div class="achievements-list" id="achievementsList">Loading...</div>
        </div>

        <!-- Recommended -->
        <div class="sidebar-panel">
            <div class="panel-header"><i class="fas fa-th-large"></i> More Like This</div>
            <div class="recommended-list" id="recommendedGames">Loading...</div>
        </div>

        <!-- Notes -->
        <div class="sidebar-panel">
            <div class="panel-header"><i class="fas fa-sticky-note"></i> Notes</div>
            <div class="notes-wrap">
                <textarea id="gameNotes" placeholder="Your notes for this game..."></textarea>
                <button class="save-notes-btn" id="saveNotesBtn">Save Notes</button>
            </div>
        </div>

    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span class="toast-text" id="toastMessage">Done!</span>
</div>

<!-- Achievement popup -->
<div class="achievement-toast" id="achievementToast">
    <div class="achievement-toast-icon" id="achievementToastIcon">üèÜ</div>
    <div>
        <div class="achievement-toast-title">Achievement Unlocked!</div>
        <div class="achievement-toast-name" id="achievementToastName"></div>
    </div>
</div>

<!-- Shortcuts modal -->
<div class="modal-overlay" id="shortcutsModal">
    <div class="modal-box">
        <button class="modal-close" id="closeModal"><i class="fas fa-times"></i></button>
        <div class="modal-title"><i class="fas fa-keyboard"></i> Keyboard Shortcuts</div>
        <div class="shortcut-row"><span>Fullscreen</span><span class="shortcut-key">F</span></div>
        <div class="shortcut-row"><span>Refresh game</span><span class="shortcut-key">R</span></div>
        <div class="shortcut-row"><span>Favorite</span><span class="shortcut-key">H</span></div>
        <div class="shortcut-row"><span>Share</span><span class="shortcut-key">Shift+S</span></div>
        <div class="shortcut-row"><span>Achievements</span><span class="shortcut-key">A</span></div>
        <div class="shortcut-row"><span>Screenshot</span><span class="shortcut-key">S</span></div>
        <div class="shortcut-row"><span>This help</span><span class="shortcut-key">?</span></div>
        <div class="shortcut-row"><span>Close modal</span><span class="shortcut-key">Esc</span></div>
    </div>
</div>

<!-- Achievements modal -->
<div class="modal-overlay" id="achievementsModal">
    <div class="modal-box">
        <button class="modal-close" id="closeAchievementsModal"><i class="fas fa-times"></i></button>
        <div class="modal-title"><i class="fas fa-trophy"></i> All Achievements</div>
        <div class="achievement-grid" id="allAchievementsGrid"></div>
    </div>
</div>

<script>
        let allGames = [];
        let currentGame = null;
        let currentGameUrl = null;
        let playtimeInterval = null;
        let sessionInterval = null;
        let sessionStartTime = Date.now();
        let analyticsChart = null;
        let currentChartType = 'playtime';
        const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

        // All achievements definition
        const allAchievements = [
            { id: 'time_5min', name: "5 Minute Player", desc: "Play for 5 minutes", time: 300, icon: "fa-trophy", color: "#ffd700" },
            { id: 'time_30min', name: "30 Minute Enthusiast", desc: "Play for 30 minutes", time: 1800, icon: "fa-medal", color: "#c0c0c0" },
            { id: 'time_1hr', name: "1 Hour Champion", desc: "Play for 1 hour", time: 3600, icon: "fa-crown", color: "#cd7f32" },
            { id: 'time_2hr', name: "2 Hour Master", desc: "Play for 2 hours", time: 7200, icon: "fa-star", color: "#4ade80" },
            { id: 'time_5hr', name: "5 Hour Legend", desc: "Play for 5 hours", time: 18000, icon: "fa-fire", color: "#ef4444" },
            { id: 'streak_3', name: "3 Day Streak", desc: "Play 3 days in a row", streak: 3, icon: "fa-calendar-check", color: "#8aadf4" },
            { id: 'streak_7', name: "Week Warrior", desc: "Play 7 days in a row", streak: 7, icon: "fa-calendar-week", color: "#f5bde6" },
            { id: 'sessions_10', name: "Regular Player", desc: "Complete 10 sessions", sessions: 10, icon: "fa-gamepad", color: "#a6da95" },
            { id: 'favorite', name: "Favorite Game", desc: "Mark as favorite", icon: "fa-heart", color: "#f5a97f" },
            { id: 'rating', name: "Critic", desc: "Rate this game", icon: "fa-star-half-alt", color: "#fbbf24" }
        ];

        // Theme management
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const savedTheme = localStorage.getItem('theme') || 'dark';
        html.setAttribute('data-theme', savedTheme);
        updateThemeIcon(savedTheme);

        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
            updateChartColors();
        });

        function updateThemeIcon(theme) {
            themeToggle.innerHTML = theme === 'dark' 
                ? '<i class="fas fa-sun"></i>' 
                : '<i class="fas fa-moon"></i>';
        }

        function formatSeconds(sec) {
            if (sec < 60) return `${sec} second${sec===1?'':'s'}`;
            if (sec < 3600) {
                const m = Math.floor(sec/60);
                return `${m} minute${m===1?'':'s'}`;
            }
            const h = Math.floor(sec/3600);
            return `${h} hour${h===1?'':'s'}`;
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toast.classList.add('active');
            setTimeout(() => {
                toast.classList.remove('active');
            }, 3000);
        }

        function updateSessionTimer() {
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            document.getElementById('sessionTime').textContent = formatTime(elapsed);
        }

        // Streak calculation
        function updateStreak() {
            const streakData = JSON.parse(localStorage.getItem('playStreak') || '{}');
            const today = new Date().toISOString().slice(0,10);
            const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0,10);
            
            let currentStreak = streakData.current || 0;
            const lastPlayDate = streakData.lastDate;
            
            if (lastPlayDate === today) {
                // Already played today, keep current streak
            } else if (lastPlayDate === yesterday) {
                // Played yesterday, increment streak
                currentStreak++;
                streakData.current = currentStreak;
                streakData.lastDate = today;
                streakData.best = Math.max(streakData.best || 0, currentStreak);
                localStorage.setItem('playStreak', JSON.stringify(streakData));
            } else if (!lastPlayDate) {
                // First time playing
                currentStreak = 1;
                streakData.current = currentStreak;
                streakData.lastDate = today;
                streakData.best = 1;
                localStorage.setItem('playStreak', JSON.stringify(streakData));
            } else {
                // Streak broken
                currentStreak = 1;
                streakData.current = currentStreak;
                streakData.lastDate = today;
                localStorage.setItem('playStreak', JSON.stringify(streakData));
            }
            
            document.getElementById('streakCount').textContent = `${currentStreak} day streak`;
            return currentStreak;
        }

        // IndexedDB functions
        function openPlaytimeDB() {
            return new Promise((resolve, reject) => {
                const req = indexedDB.open("GamePlaytimeDB", 2);
                req.onupgradeneeded = function(e) {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains("playtimes")) {
                        db.createObjectStore("playtimes", { keyPath: ["slug", "date"] });
                    }
                    if (!db.objectStoreNames.contains("sessions")) {
                        db.createObjectStore("sessions", { keyPath: "id", autoIncrement: true });
                    }
                };
                req.onsuccess = () => resolve(req.result);
                req.onerror = e => reject(e.target.error);
            });
        }

        function updatePlaytimeToday(slug) {
            const today = new Date().toISOString().slice(0,10);
            openPlaytimeDB().then(db => {
                const tx = db.transaction("playtimes", "readwrite");
                const store = tx.objectStore("playtimes");
                const key = [slug, today];
                store.get(key).onsuccess = function (e) {
                    let data = e.target.result;
                    if (!data) data = { slug, date: today, seconds: 0 };
                    data.seconds++;
                    store.put(data);
                };
                db.close();
            });
        }

        function saveSession(slug, duration) {
            openPlaytimeDB().then(db => {
                const tx = db.transaction("sessions", "readwrite");
                const store = tx.objectStore("sessions");
                store.add({
                    slug,
                    duration,
                    timestamp: Date.now(),
                    date: new Date().toISOString().slice(0,10)
                });
                db.close();
            });
        }

        function getPlaytimeDays(slug) {
            return new Promise(resolve => {
                openPlaytimeDB().then(db => {
                    const tx = db.transaction("playtimes", "readonly");
                    const store = tx.objectStore("playtimes");
                    const req = store.openCursor();
                    const days = [];
                    req.onsuccess = function(event) {
                        const cursor = event.target.result;
                        if(cursor) {
                            if(cursor.key[0] === slug) days.push(cursor.value);
                            cursor.continue();
                        } else {
                            db.close();
                            days.sort((a,b) => a.date.localeCompare(b.date));
                            resolve(days);
                        }
                    };
                }).catch(() => resolve([]));
            });
        }

        function getSessions(slug) {
            return new Promise(resolve => {
                openPlaytimeDB().then(db => {
                    const tx = db.transaction("sessions", "readonly");
                    const store = tx.objectStore("sessions");
                    const req = store.openCursor();
                    const sessions = [];
                    req.onsuccess = function(event) {
                        const cursor = event.target.result;
                        if(cursor) {
                            if(cursor.value.slug === slug) sessions.push(cursor.value);
                            cursor.continue();
                        } else {
                            db.close();
                            resolve(sessions);
                        }
                    };
                }).catch(() => resolve([]));
            });
        }

        function drawAnalyticsChart(type, data) {
            const ctx = document.getElementById('analyticsChart').getContext('2d');
            
            if (analyticsChart) analyticsChart.destroy();

            const isDark = html.getAttribute('data-theme') === 'dark';
            const gridColor = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
            const textColor = isDark ? '#a0a0a0' : '#666666';

            let chartConfig = {
                type: type === 'sessions' ? 'bar' : 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#23262f',
                            bodyColor: '#ffd09c',
                            titleColor: '#fff',
                            borderColor: "#ffd09c",
                            borderWidth: 1.5,
                            padding: 14,
                            cornerRadius: 8
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: textColor },
                            grid: { color: gridColor }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { color: textColor },
                            grid: { color: gridColor }
                        }
                    }
                }
            };

            if (type === 'streak') {
                chartConfig.type = 'line';
                chartConfig.options.elements = {
                    line: {
                        tension: 0.4
                    },
                    point: {
                        radius: 5,
                        hoverRadius: 7
                    }
                };
            }

            analyticsChart = new Chart(ctx, chartConfig);
        }

        function updateChartColors() {
            if (analyticsChart) {
                const isDark = html.getAttribute('data-theme') === 'dark';
                const gridColor = isDark ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
                const textColor = isDark ? '#a0a0a0' : '#666666';
                
                analyticsChart.options.scales.x.ticks.color = textColor;
                analyticsChart.options.scales.x.grid.color = gridColor;
                analyticsChart.options.scales.y.ticks.color = textColor;
                analyticsChart.options.scales.y.grid.color = gridColor;
                analyticsChart.update();
            }
        }

        async function updateCharts(slug) {
            const playArr = await getPlaytimeDays(slug);
            const sessions = await getSessions(slug);
            
            if (currentChartType === 'playtime') {
                const labels = playArr.map(x => x.date);
                const data = playArr.map(x => Math.round(x.seconds/60*100)/100);
                
                drawAnalyticsChart('playtime', {
                    labels,
                    datasets: [{
                        label: 'Minutes Played',
                        backgroundColor: 'rgba(245, 169, 127, 0.2)',
                        borderColor: '#f5a97f',
                        borderWidth: 3,
                        data,
                        fill: true,
                        tension: 0.4
                    }]
                });
            } else if (currentChartType === 'sessions') {
                const sessionsByDate = {};
                sessions.forEach(s => {
                    if (!sessionsByDate[s.date]) sessionsByDate[s.date] = 0;
                    sessionsByDate[s.date]++;
                });
                
                const labels = Object.keys(sessionsByDate).sort();
                const data = labels.map(d => sessionsByDate[d]);
                
                drawAnalyticsChart('sessions', {
                    labels,
                    datasets: [{
                        label: 'Sessions',
                        backgroundColor: '#a6da95',
                        borderColor: '#8cc084',
                        borderWidth: 2,
                        borderRadius: 10,
                        data,
                        maxBarThickness: 38
                    }]
                });
            } else if (currentChartType === 'streak') {
                const labels = playArr.map(x => x.date);
                let streakData = [];
                let currentStreakValue = 0;
                
                for (let i = 0; i < playArr.length; i++) {
                    if (i === 0 || 
                        new Date(playArr[i].date).getTime() - new Date(playArr[i-1].date).getTime() === 86400000) {
                        currentStreakValue++;
                    } else {
                        currentStreakValue = 1;
                    }
                    streakData.push(currentStreakValue);
                }
                
                drawAnalyticsChart('streak', {
                    labels,
                    datasets: [{
                        label: 'Streak',
                        backgroundColor: 'rgba(138, 173, 244, 0.2)',
                        borderColor: '#8aadf4',
                        borderWidth: 3,
                        data: streakData,
                        fill: true
                    }]
                });
            }
        }

        // Chart tab switching
        document.querySelectorAll('.chart-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentChartType = tab.dataset.chart;
                updateCharts(currentGameUrl);
            });
        });

        function updatePlaytimeCounter(val) {
            document.getElementById('yourPlaytime').textContent = val;
        }

        function checkAchievements(playtime) {
            const achievementKey = 'achievements_' + currentGameUrl;
            const unlockedAchievements = JSON.parse(localStorage.getItem(achievementKey) || '[]');
            
            allAchievements.forEach(achievement => {
                if (achievement.time && playtime >= achievement.time && !unlockedAchievements.includes(achievement.id)) {
                    unlockedAchievements.push(achievement.id);
                    localStorage.setItem(achievementKey, JSON.stringify(unlockedAchievements));
                    showAchievement(achievement);
                    showToast(`üéâ Achievement Unlocked: ${achievement.name}!`);
                }
            });

            // Check streak achievements
            const currentStreak = JSON.parse(localStorage.getItem('playStreak') || '{}').current || 0;
            allAchievements.forEach(achievement => {
                if (achievement.streak && currentStreak >= achievement.streak && !unlockedAchievements.includes(achievement.id)) {
                    unlockedAchievements.push(achievement.id);
                    localStorage.setItem(achievementKey, JSON.stringify(unlockedAchievements));
                    showAchievement(achievement);
                    showToast(`üéâ Achievement Unlocked: ${achievement.name}!`);
                }
            });

            updateProgressBar(playtime);
        }

        function showAchievement(achievement) {
            const badgeContainer = document.getElementById('achievementBadge');
            const badge = document.createElement('div');
            badge.className = 'achievement-badge';
            badge.innerHTML = `<i class="fas ${achievement.icon}"></i> ${achievement.name}`;
            badgeContainer.appendChild(badge);
        }

        function updateProgressBar(playtime) {
            const timeMilestones = allAchievements.filter(a => a.time).map(a => a.time);
            let nextMilestone = timeMilestones.find(m => playtime < m);
            
            if (!nextMilestone) {
                document.getElementById('progressText').textContent = 'All time achievements unlocked! üéâ';
                document.getElementById('progressFill').style.width = '100%';
                document.getElementById('progressPercent').textContent = '100%';
                return;
            }

            const prevMilestone = timeMilestones[timeMilestones.indexOf(nextMilestone) - 1] || 0;
            const progress = ((playtime - prevMilestone) / (nextMilestone - prevMilestone)) * 100;
            
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
            
            const timeLeft = nextMilestone - playtime;
            document.getElementById('progressText').textContent = 
                `${formatSeconds(timeLeft)} until next achievement`;
        }

        function loadAndShowPlaytime(slug) {
            const saved = parseInt(localStorage.getItem('playtime_' + slug) || '0', 10);
            updatePlaytimeCounter(formatSeconds(saved));
            checkAchievements(saved);
            updateMiniStats(slug);

            if (playtimeInterval) clearInterval(playtimeInterval);

            function refreshCharts() { 
                updateCharts(slug);
            }
            refreshCharts();

            playtimeInterval = setInterval(() => {
                if (document.hasFocus() && document.activeElement !== document.getElementById('gameIframe')) {
                    let playtime = parseInt(localStorage.getItem('playtime_' + slug) || '0', 10);
                    playtime++;
                    localStorage.setItem('playtime_' + slug, playtime);
                    updatePlaytimeCounter(formatSeconds(playtime));
                    updatePlaytimeToday(slug);
                    checkAchievements(playtime);
                    if (playtime % 60 === 0) {
                        refreshCharts();
                        updateMiniStats(slug);
                        updatePerformanceStats(slug);
                    }
                }
            }, 1000);
        }

        async function updateMiniStats(slug) {
            const sessions = await getSessions(slug);
            const playArr = await getPlaytimeDays(slug);
            
            // Last played
            if (playArr.length > 0) {
                const lastDate = playArr[playArr.length - 1].date;
                const today = new Date().toISOString().slice(0,10);
                if (lastDate === today) {
                    document.getElementById('lastPlayed').textContent = 'Playing today';
                } else {
                    const daysAgo = Math.floor((Date.now() - new Date(lastDate).getTime()) / 86400000);
                    document.getElementById('lastPlayed').textContent = `${daysAgo} day${daysAgo===1?'':'s'} ago`;
                }
            }
            
            // Total sessions
            document.getElementById('totalSessions').textContent = `${sessions.length} session${sessions.length===1?'':'s'}`;
            
            // Average session
            if (sessions.length > 0) {
                const avgDuration = sessions.reduce((sum, s) => sum + s.duration, 0) / sessions.length;
                document.getElementById('avgSession').textContent = `${Math.round(avgDuration/60)} min avg`;
            }

            // Check session achievements
            const achievementKey = 'achievements_' + currentGameUrl;
            const unlockedAchievements = JSON.parse(localStorage.getItem(achievementKey) || '[]');
            allAchievements.forEach(achievement => {
                if (achievement.sessions && sessions.length >= achievement.sessions && !unlockedAchievements.includes(achievement.id)) {
                    unlockedAchievements.push(achievement.id);
                    localStorage.setItem(achievementKey, JSON.stringify(unlockedAchievements));
                    showAchievement(achievement);
                    showToast(`üéâ Achievement Unlocked: ${achievement.name}!`);
                }
            });
        }

        async function updatePerformanceStats(slug) {
            const playArr = await getPlaytimeDays(slug);
            const today = new Date().toISOString().slice(0,10);
            
            // Today
            const todayData = playArr.find(p => p.date === today);
            if (todayData) {
                document.getElementById('todayPlaytime').innerHTML = 
                    `<i class="fas fa-arrow-up"></i> ${Math.round(todayData.seconds/60)}m`;
            }
            
            // This week
            const weekAgo = new Date(Date.now() - 7 * 86400000).toISOString().slice(0,10);
            const weekData = playArr.filter(p => p.date >= weekAgo);
            const weekTotal = weekData.reduce((sum, p) => sum + p.seconds, 0);
            document.getElementById('weekPlaytime').textContent = `${Math.round(weekTotal/60)}m`;
            
            // This month
            const monthAgo = new Date(Date.now() - 30 * 86400000).toISOString().slice(0,10);
            const monthData = playArr.filter(p => p.date >= monthAgo);
            const monthTotal = monthData.reduce((sum, p) => sum + p.seconds, 0);
            document.getElementById('monthPlaytime').textContent = `${Math.round(monthTotal/60)}m`;
        }

        async function loadGameData() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const gameUrl = urlParams.get('game');
                
                if (!gameUrl) {
                    window.location.href = 'home.html';
                    return;
                }

                currentGameUrl = gameUrl;

                const response = await fetch('https://ubghyper.github.io/assets/games.json');
                if (!response.ok) throw new Error('Failed to load games');
                
                allGames = await response.json();
                currentGame = allGames.find(g => g.url === gameUrl);

                if (!currentGame) {
                    alert('Game not found!');
                    window.location.href = 'index.html';
                    return;
                }

                document.title = `Play ${currentGame.name} Unblocked Free ‚Äì UnblockedGames67`;
            // ‚ïê‚ïê‚ïê Dynamic SEO meta updates ‚ïê‚ïê‚ïê
            const gameName = currentGame.name;
            const gameDesc = currentGame.gamedesc || `Play ${gameName} unblocked free online at school ‚Äî no downloads needed!`;
            const gameUrl = `https://unblockedgames67.github.io/play.html?game=${encodeURIComponent(currentGameUrl)}`;
            const gameImg = `https://ubghyper.github.io/GameList.github.io/${currentGameUrl}/${currentGame.image}`;
            const gameCategory = (currentGame.tags && currentGame.tags[0]) || 'games';

            // Update <title>
            document.getElementById('pageTitle').textContent = `Play ${gameName} Unblocked Free Online ‚Äì UnblockedGames67`;
            // Description
            document.getElementById('pageDesc').setAttribute('content', `Play ${gameName} unblocked free online at school with no downloads on UnblockedGames67. ${gameDesc}`);
            // Canonical
            document.getElementById('pageCanonical').setAttribute('href', gameUrl);
            // OG tags
            document.getElementById('ogUrl').setAttribute('content', gameUrl);
            document.getElementById('ogTitle').setAttribute('content', `Play ${gameName} Unblocked Free ‚Äì UnblockedGames67`);
            document.getElementById('ogDesc').setAttribute('content', `${gameDesc} Play instantly at school, no downloads!`);
            document.getElementById('ogImage').setAttribute('content', gameImg);
            // Twitter
            document.getElementById('twTitle').setAttribute('content', `Play ${gameName} Unblocked ‚Äì UnblockedGames67`);
            document.getElementById('twDesc').setAttribute('content', `Play ${gameName} free unblocked at school on UnblockedGames67!`);
            document.getElementById('twImage').setAttribute('content', gameImg);
            // Game Schema (VideoGame type)
            document.getElementById('gameSchema').textContent = JSON.stringify({
                "@context": "https://schema.org",
                "@type": "VideoGame",
                "name": gameName + " Unblocked",
                "description": gameDesc,
                "url": gameUrl,
                "image": gameImg,
                "genre": gameCategory,
                "gamePlatform": "Web Browser",
                "applicationCategory": "Game",
                "operatingSystem": "Any",
                "offers": {"@type": "Offer", "price": "0", "priceCurrency": "USD"},
                "isPartOf": {"@type": "WebSite", "name": "Unblocked Games 67", "url": "https://unblockedgames67.github.io/"}
            });
            // Breadcrumb schema
            document.getElementById('breadcrumbSchema').textContent = JSON.stringify({
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",
                "itemListElement": [
                    {"@type": "ListItem", "position": 1, "name": "Unblocked Games 67", "item": "https://unblockedgames67.github.io/"},
                    {"@type": "ListItem", "position": 2, "name": gameName + " Unblocked", "item": gameUrl}
                ]
            });

                // Dynamic SEO meta tags for game pages
                const metaDesc = document.querySelector('meta[name="description"]');
                if (metaDesc) metaDesc.setAttribute('content', `Play ${currentGame.name} unblocked for free at UBGHyper. ${currentGame.gamedesc || ''} No downloads required!`);
                const ogTitle = document.querySelector('meta[property="og:title"]');
                if (ogTitle) ogTitle.setAttribute('content', `Play ${currentGame.name} Free - UBGHyper Unblocked Games`);
                else { const m = document.createElement('meta'); m.setAttribute('property','og:title'); m.setAttribute('content', `Play ${currentGame.name} Free - UBGHyper Unblocked Games`); document.head.appendChild(m); }
                const ogDesc = document.querySelector('meta[property="og:description"]');
                if (ogDesc) ogDesc.setAttribute('content', `Play ${currentGame.name} unblocked online. ${currentGame.gamedesc || ''}`);
                else { const m = document.createElement('meta'); m.setAttribute('property','og:description'); m.setAttribute('content', `Play ${currentGame.name} unblocked online. ${currentGame.gamedesc || ''}`); document.head.appendChild(m); }
                const ogUrl = document.querySelector('meta[property="og:url"]');
                if (ogUrl) ogUrl.setAttribute('content', `https://ubghyper.github.io/play.html?game=${gameUrl}`);
                else { const m = document.createElement('meta'); m.setAttribute('property','og:url'); m.setAttribute('content', `https://ubghyper.github.io/play.html?game=${gameUrl}`); document.head.appendChild(m); }
                // Set canonical URL for each game page
                let canonical = document.querySelector('link[rel="canonical"]');
                if (!canonical) { canonical = document.createElement('link'); canonical.setAttribute('rel','canonical'); document.head.appendChild(canonical); }
                canonical.setAttribute('href', `https://ubghyper.github.io/play.html?game=${gameUrl}`);

                displayGameInfo();
                loadGameIframe();
                loadRecommendedGames();
                loadAndShowPlaytime(gameUrl);
                trackRecentlyPlayed(gameUrl);
                loadGameNotes();
                startSessionTimer();
                updateStreak();

            } catch (error) {
                console.error('Error loading game:', error);
                alert('Error loading game. Please try again.');
            }
        }

        function startSessionTimer() {
            sessionStartTime = Date.now();
            updateSessionTimer();
            sessionInterval = setInterval(updateSessionTimer, 1000);
            
            // Save session on page unload
            window.addEventListener('beforeunload', () => {
                const sessionDuration = Math.floor((Date.now() - sessionStartTime) / 1000);
                if (sessionDuration > 30) { // Only save sessions longer than 30 seconds
                    saveSession(currentGameUrl, sessionDuration);
                }
            });
        }

        function trackRecentlyPlayed(gameUrl) {
            let recent = JSON.parse(localStorage.getItem('recentlyPlayed') || '[]');
            recent = recent.filter(r => r.url !== gameUrl);
            recent.unshift({ url: gameUrl, timestamp: Date.now() });
            recent = recent.slice(0, 20);
            localStorage.setItem('recentlyPlayed', JSON.stringify(recent));
        }

        function displayGameInfo() {
            document.getElementById('loadingInfo').style.display = 'none';
            document.getElementById('gameInfo').style.display = 'block';

            document.getElementById('gameTitle').textContent = currentGame.name;
            document.getElementById('gameAuthor').textContent = currentGame.credits || 'Unknown Developer';
            document.getElementById('gameDescription').textContent = currentGame.gamedesc || 'No description available.';
            document.getElementById('gameCategory').textContent = (currentGame.tags && currentGame.tags[0]) || 'Game';

            const isFavorite = favorites.includes(currentGameUrl);
            const favoriteBtn = document.getElementById('favoriteBtn');
            favoriteBtn.classList.toggle('active', isFavorite);
            favoriteBtn.innerHTML = isFavorite 
                ? '<i class="fas fa-heart"></i> Favorited'
                : '<i class="far fa-heart"></i> Favorite';

            document.getElementById('playCount').textContent = Math.floor(Math.random() * 10000);
            document.getElementById('avgRating').textContent = (4 + Math.random()).toFixed(1);

            const savedRating = parseInt(localStorage.getItem('rating_' + currentGameUrl) || '0');
            if (savedRating > 0) {
                const stars = document.querySelectorAll('.star');
                stars.forEach((s, i) => {
                    s.classList.toggle('active', i < savedRating);
                });
            }

            displayUnlockedAchievements();
        }

        function displayUnlockedAchievements() {
            const achievementKey = 'achievements_' + currentGameUrl;
            const unlockedAchievements = JSON.parse(localStorage.getItem(achievementKey) || '[]');
            const badgeContainer = document.getElementById('achievementBadge');

            unlockedAchievements.forEach(achievementId => {
                const achievement = allAchievements.find(a => a.id === achievementId);
                if (achievement) {
                    const badge = document.createElement('div');
                    badge.className = 'achievement-badge';
                    badge.innerHTML = `<i class="fas ${achievement.icon}"></i> ${achievement.name}`;
                    badgeContainer.appendChild(badge);
                }
            });
        }

        function showAllAchievements() {
            const achievementKey = 'achievements_' + currentGameUrl;
            const unlockedAchievements = JSON.parse(localStorage.getItem(achievementKey) || '[]');
            const grid = document.getElementById('achievementsGrid');
            
            grid.innerHTML = allAchievements.map(achievement => {
                const isUnlocked = unlockedAchievements.includes(achievement.id);
                return `
                    <div class="achievement-card ${isUnlocked ? 'unlocked' : 'locked'}">
                        <div class="achievement-icon" style="color: ${achievement.color}">
                            <i class="fas ${achievement.icon}"></i>
                        </div>
                        <div class="achievement-name">${achievement.name}</div>
                        <div class="achievement-desc">${achievement.desc}</div>
                        ${isUnlocked ? '<div style="color: var(--success); margin-top: 0.5rem;"><i class="fas fa-check"></i> Unlocked</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        function loadGameIframe() {
            const iframe = document.getElementById('gameIframe');
            iframe.src = `https://ubghyper.github.io/GameList.github.io/${currentGameUrl}/`;
        }

        function loadRecommendedGames() {
            const recommendedContainer = document.getElementById('recommendedGames');
            const currentCategory = currentGame.tags && currentGame.tags[0];
            
            let recommended = allGames.filter(g => 
                g.url !== currentGameUrl && 
                g.tags && 
                g.tags.includes(currentCategory)
            ).slice(0, 5);

            if (recommended.length < 3) {
                recommended = allGames.filter(g => g.url !== currentGameUrl).slice(0, 5);
            }

            recommendedContainer.innerHTML = recommended.map(game => `
                <a href="play.html?game=${encodeURIComponent(game.url)}" class="recommended-item">
                    <img src="https://ubghyper.github.io/GameList.github.io/${game.url}/${game.image}" 
                         alt="${game.name}" 
                         class="recommended-image"
                         onerror="this.src='https://via.placeholder.com/80/f5a97f/fff?text=${encodeURIComponent(game.name)}'">
                    <div class="recommended-info">
                        <div class="recommended-title">${game.name}</div>
                        <div class="recommended-category">${game.tags && game.tags[0] || 'Game'}</div>
                    </div>
                </a>
            `).join('');
        }

        function loadGameNotes() {
            const notesKey = 'notes_' + currentGameUrl;
            const savedNotes = localStorage.getItem(notesKey) || '';
            document.getElementById('gameNotes').value = savedNotes;
        }

        // Event listeners
        document.getElementById('saveNotesBtn').addEventListener('click', () => {
            const notesKey = 'notes_' + currentGameUrl;
            const notes = document.getElementById('gameNotes').value;
            localStorage.setItem(notesKey, notes);
            showToast('Notes saved successfully!');
        });

        document.getElementById('fullscreenBtn').addEventListener('click', () => {
            const iframe = document.getElementById('gameIframe');
            if (iframe.requestFullscreen) {
                iframe.requestFullscreen();
            } else if (iframe.webkitRequestFullscreen) {
                iframe.webkitRequestFullscreen();
            }
        });

        document.getElementById('refreshBtn').addEventListener('click', () => {
            const iframe = document.getElementById('gameIframe');
            iframe.src = iframe.src;
            showToast('Game refreshed!');
        });

        document.getElementById('screenshotBtn').addEventListener('click', async () => {
            showToast('Screenshot feature coming soon!');
        });

        document.getElementById('pipBtn').addEventListener('click', async () => {
            showToast('Picture-in-Picture feature coming soon!');
        });

        document.getElementById('favoriteBtn').addEventListener('click', () => {
            const index = favorites.indexOf(currentGameUrl);
            const favoriteBtn = document.getElementById('favoriteBtn');
            const achievementKey = 'achievements_' + currentGameUrl;
            const unlockedAchievements = JSON.parse(localStorage.getItem(achievementKey) || '[]');
            
            if (index > -1) {
                favorites.splice(index, 1);
                favoriteBtn.classList.remove('active');
                favoriteBtn.innerHTML = '<i class="far fa-heart"></i> Favorite';
                showToast('Removed from favorites');
            } else {
                favorites.push(currentGameUrl);
                favoriteBtn.classList.add('active');
                favoriteBtn.innerHTML = '<i class="fas fa-heart"></i> Favorited';
                showToast('Added to favorites!');
                
                // Check favorite achievement
                const favAchievement = allAchievements.find(a => a.id === 'favorite');
                if (favAchievement && !unlockedAchievements.includes('favorite')) {
                    unlockedAchievements.push('favorite');
                    localStorage.setItem(achievementKey, JSON.stringify(unlockedAchievements));
                    showAchievement(favAchievement);
                    showToast(`üéâ Achievement Unlocked: ${favAchievement.name}!`);
                }
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
        });

        document.getElementById('shareBtn').addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: `Play ${currentGame.name} on UBGHyper`,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                showToast('Link copied to clipboard!');
            }
        });

        document.getElementById('achievementsBtn').addEventListener('click', () => {
            showAllAchievements();
            document.getElementById('achievementsModal').classList.add('active');
        });

        document.getElementById('closeAchievementsModal').addEventListener('click', () => {
            document.getElementById('achievementsModal').classList.remove('active');
        });

        document.getElementById('shortcutsBtn').addEventListener('click', () => {
            document.getElementById('shortcutsModal').classList.add('active');
        });

        document.getElementById('closeModal').addEventListener('click', () => {
            document.getElementById('shortcutsModal').classList.remove('active');
        });

        document.getElementById('shortcutsModal').addEventListener('click', (e) => {
            if (e.target.id === 'shortcutsModal') {
                document.getElementById('shortcutsModal').classList.remove('active');
            }
        });

        document.getElementById('achievementsModal').addEventListener('click', (e) => {
            if (e.target.id === 'achievementsModal') {
                document.getElementById('achievementsModal').classList.remove('active');
            }
        });

        const stars = document.querySelectorAll('.star');
        stars.forEach((star) => {
            star.addEventListener('click', () => {
                const rating = parseInt(star.dataset.rating);
                stars.forEach((s, i) => {
                    s.classList.toggle('active', i < rating);
                });
                localStorage.setItem('rating_' + currentGameUrl, rating);
                showToast(`Rated ${rating} stars!`);
                
                // Check rating achievement
                const achievementKey = 'achievements_' + currentGameUrl;
                const unlockedAchievements = JSON.parse(localStorage.getItem(achievementKey) || '[]');
                const ratingAchievement = allAchievements.find(a => a.id === 'rating');
                if (ratingAchievement && !unlockedAchievements.includes('rating')) {
                    unlockedAchievements.push('rating');
                    localStorage.setItem(achievementKey, JSON.stringify(unlockedAchievements));
                    showAchievement(ratingAchievement);
                    showToast(`üéâ Achievement Unlocked: ${ratingAchievement.name}!`);
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;

            switch(e.key.toLowerCase()) {
                case 'f':
                    e.preventDefault();
                    document.getElementById('fullscreenBtn').click();
                    break;
                case 'r':
                    e.preventDefault();
                    document.getElementById('refreshBtn').click();
                    break;
                case 's':
                    if (e.shiftKey) {
                        e.preventDefault();
                        document.getElementById('shareBtn').click();
                    } else {
                        e.preventDefault();
                        document.getElementById('screenshotBtn').click();
                    }
                    break;
                case 'h':
                    e.preventDefault();
                    document.getElementById('favoriteBtn').click();
                    break;
                case 'a':
                    e.preventDefault();
                    document.getElementById('achievementsBtn').click();
                    break;
                case '?':
                    document.getElementById('shortcutsModal').classList.add('active');
                    break;
                case 'escape':
                    document.getElementById('shortcutsModal').classList.remove('active');
                    document.getElementById('achievementsModal').classList.remove('active');
                    break;
            }
        });

        loadGameData();
    </script>

<!-- Patch: update nav and sidebar with game name on load -->
<script>
    // Update nav title
    const origLoadGameData = loadGameData;
    function loadGameData() {
        origLoadGameData();
    }

    // Patch initGame to update new UI elements
    const origLoadGame = typeof loadGame === 'function' ? loadGame : null;

    // Observe when currentGame is set and update new UI
    function patchPlayPageUI() {
        if (typeof currentGame === 'undefined' || !currentGame) {
            setTimeout(patchPlayPageUI, 200);
            return;
        }
        // Nav title
        const navTitle = document.getElementById('navGameTitle');
        if (navTitle) navTitle.textContent = currentGame.name;

        // Game name display
        const nameDisplay = document.getElementById('gameNameDisplay');
        if (nameDisplay) nameDisplay.innerHTML = currentGame.name.replace(/(\d+)/, '<span>$1</span>');

        // Tag badge
        const tagBadge = document.getElementById('gameTagBadge');
        if (tagBadge) tagBadge.textContent = (currentGame.tags && currentGame.tags[0]) || 'game';

        // Description
        const descEl = document.getElementById('gameDescription');
        if (descEl && currentGame.gamedesc) descEl.textContent = currentGame.gamedesc;

        // Credits small
        const credSmall = document.getElementById('gameCreditsSmall');
        if (credSmall && currentGame.credits) credSmall.textContent = currentGame.credits;
        const credBig = document.getElementById('gameCredits');
        if (credBig && currentGame.credits) credBig.textContent = currentGame.credits;

        // Hide loading overlay once iframe src is set
        const iframe = document.getElementById('gameIframe');
        const loading = document.getElementById('gameLoading');
        if (iframe && loading) {
            iframe.addEventListener('load', () => { loading.style.display = 'none'; }, { once: true });
        }

        // Neon border on game frame when playing
        setTimeout(() => {
            const frame = document.getElementById('gameFrame');
            if (frame) frame.classList.add('neon-border');
        }, 500);
    }

    // Override showAchievement for new toast style
    function showAchievement(achievement) {
        const toast = document.getElementById('achievementToast');
        const icon = document.getElementById('achievementToastIcon');
        const name = document.getElementById('achievementToastName');
        if (toast && icon && name) {
            icon.textContent = achievement.icon || 'üèÜ';
            name.textContent = achievement.name;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 4000);
        }
    }

    // Patch sidebar action buttons
    document.getElementById('shortcutsBtnSide')?.addEventListener('click', () => {
        document.getElementById('shortcutsModal').classList.add('active');
    });

    // Patch recommended items with new style
    const origLoadRec = typeof loadRecommendedGames === 'function' ? loadRecommendedGames : null;

    // Re-render recommended with new card style
    function patchRecommended() {
        if (typeof allGames === 'undefined' || !allGames.length || typeof currentGame === 'undefined') {
            setTimeout(patchRecommended, 300);
            return;
        }
        const container = document.getElementById('recommendedGames');
        if (!container) return;
        const cat = currentGame.tags && currentGame.tags[0];
        let recs = allGames.filter(g => g.url !== currentGameUrl && g.tags && g.tags.includes(cat)).slice(0, 6);
        if (recs.length < 3) recs = allGames.filter(g => g.url !== currentGameUrl).slice(0, 6);
        container.innerHTML = recs.map(g => `
            <a href="play.html?game=${encodeURIComponent(g.url)}" class="rec-item">
                <img class="rec-img" loading="lazy"
                    src="https://ubghyper.github.io/GameList.github.io/${g.url}/${g.image}"
                    alt="${g.name}"
                    onerror="this.src='https://via.placeholder.com/44x44/0e0e16/00F5D4?text=G'">
                <div>
                    <div class="rec-name">${g.name}</div>
                    <div class="rec-tag">${g.tags && g.tags[0] || 'game'}</div>
                </div>
            </a>
        `).join('');
    }

    // Patch achievements sidebar list
    function patchAchievementsList() {
        if (typeof allAchievements === 'undefined' || typeof currentGameUrl === 'undefined') {
            setTimeout(patchAchievementsList, 300);
            return;
        }
        const list = document.getElementById('achievementsList');
        const grid = document.getElementById('allAchievementsGrid');
        const unlocked = JSON.parse(localStorage.getItem('achievements_' + currentGameUrl) || '[]');

        if (list) {
            list.innerHTML = allAchievements.slice(0,4).map(a => {
                const done = unlocked.includes(a.id);
                return `<div class="achievement-item ${done ? '' : 'locked'}">
                    <span class="achievement-icon">${a.icon}</span>
                    <div>
                        <div class="achievement-name">${a.name}</div>
                        <div class="achievement-desc">${a.description}</div>
                    </div>
                    ${done ? '<i class="fas fa-check achievement-check"></i>' : ''}
                </div>`;
            }).join('');
        }

        if (grid) {
            grid.innerHTML = allAchievements.map(a => {
                const done = unlocked.includes(a.id);
                return `<div class="achievement-card ${done ? 'unlocked' : 'locked'}">
                    <div class="ach-icon">${a.icon}</div>
                    <div class="ach-name">${a.name}</div>
                    <div class="ach-desc">${a.description}</div>
                </div>`;
            }).join('');
        }
    }

    // Run patches
    setTimeout(() => {
        patchPlayPageUI();
        patchRecommended();
        patchAchievementsList();
    }, 400);
</script>


<!-- COOKIE CONSENT -->
<div id="cookieBanner" style="
    position:fixed;bottom:0;left:0;right:0;z-index:99999;
    background:var(--bg-elevated);border-top:1px solid var(--border-bright);
    padding:0.85rem 1.5rem;display:flex;align-items:center;justify-content:space-between;
    gap:1rem;flex-wrap:wrap;box-shadow:0 -4px 20px rgba(0,0,0,0.4);
">
    <p style="font-size:0.82rem;color:var(--text-dim);margin:0;flex:1;min-width:200px;">
        üç™ We use cookies for analytics and Google AdSense ads.
        See our <a href="privacy.html" style="color:var(--cyan);">Privacy Policy</a>.
    </p>
    <button onclick="document.getElementById('cookieBanner').style.display='none';localStorage.setItem('cookieConsent','1');"
        style="padding:0.45rem 1.2rem;background:var(--cyan);border:none;border-radius:6px;color:#000;font-family:'Barlow Condensed',sans-serif;font-weight:800;font-size:0.8rem;letter-spacing:0.06em;text-transform:uppercase;cursor:pointer;flex-shrink:0;">
        Accept
    </button>
</div>
<script>
    if (localStorage.getItem('cookieConsent')) document.getElementById('cookieBanner').style.display='none';
</script>

</body>
</html>
